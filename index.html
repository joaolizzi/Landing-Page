<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Slot Demo ‚Äî Vers√£o avan√ßada (original)</title>
<style>
  :root{
    --bg1:#071028; --bg2:#071827;
    --card:#081827; --accent:#ffb63b; --accent2:#ff6b6b;
    --glass: rgba(255,255,255,0.03);
    --muted:#93a4b2;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#eaf6ff; display:flex;align-items:center;justify-content:center;padding:18px;
  }
  .wrap{width:100%;max-width:980px;display:grid;grid-template-columns:1fr 360px;gap:18px;}
  @media(max-width:900px){.wrap{grid-template-columns:1fr;}}
  .board{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;padding:18px; box-shadow:0 12px 30px rgba(2,6,23,0.6);
  }
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#071028;font-size:22px}
  h1{margin:0;font-size:18px}
  .muted{color:var(--muted);font-size:13px}

  /* reels area */
  .reels{
    background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);
    padding:18px;border-radius:12px;display:flex;gap:14px;align-items:center;justify-content:center;
  }
  .reel{
    width:120px;height:180px;overflow:hidden;border-radius:12px;background:linear-gradient(180deg,#071827,#08283a);
    position:relative;border:1px solid rgba(255,255,255,0.04);box-shadow:inset 0 2px 8px rgba(0,0,0,0.6);
    display:flex;align-items:center;justify-content:center;
    perspective:800px;
  }
  .reel .viewport{
    width:100%;height:100%;position:absolute;left:0;top:0;will-change:transform;
  }
  .slot-row{
    height:180px;display:flex;align-items:center;justify-content:center;font-size:56px;
    user-select:none;
  }
  /* motion blur effect using filter while spinning */
  .reel.spin .viewport{filter:blur(2.6px) saturate(1.05);transform-origin:center; transition:filter 200ms}
  .reel.win{box-shadow:0 10px 36px rgba(255,190,40,0.22), 0 2px 8px rgba(255,110,110,0.06);transform:translateY(-6px);}

  /* controls */
  .controls{display:flex;align-items:center;gap:12px;margin-top:12px}
  .spacer{flex:1}
  .btn{background:var(--accent);border:0;padding:12px 18px;border-radius:10px;font-weight:800;color:#071028;cursor:pointer;box-shadow:0 8px 22px rgba(255,182,60,0.12)}
  .btn:active{transform:translateY(1px)}
  input[type=number]{width:110px;border-radius:10px;padding:10px;border:0;background:#071827;color:#dff6ff;font-weight:700;text-align:center}

  /* sidebar */
  .side{padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border-radius:12px}
  .stat{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
  .big{font-size:20px;font-weight:800}
  .small{font-size:13px;color:var(--muted)}

  /* particle canvas overlays */
  canvas{position:absolute;left:0;top:0;pointer-events:none}

  /* shimmer */
  .glow{position:relative;overflow:hidden}
  .glow::after{content:"";position:absolute;left:-120%;top:0;width:40%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.06),transparent);transform:skewX(-18deg);animation:shimmer 5s linear infinite}
  @keyframes shimmer{to{left:120%}}

  footer{color:var(--muted);font-size:12px;margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="board">
      <div class="topbar">
        <div class="brand">
          <div class="logo">RT</div>
          <div>
            <h1>Roleta Avan√ßada</h1>
            <div class="muted">Vers√£o estilo ‚Äî original e legal</div>
          </div>
        </div>
        <div>
          <div class="muted" style="text-align:right">Sem dinheiro real ‚Ä¢ Demo</div>
        </div>
      </div>

      <div style="position:relative">
        <div class="reels" id="reels">
          <div class="reel" id="reel0" aria-label="Rolo 1"><div class="viewport" id="vp0"></div></div>
          <div class="reel" id="reel1" aria-label="Rolo 2"><div class="viewport" id="vp1"></div></div>
          <div class="reel" id="reel2" aria-label="Rolo 3"><div class="viewport" id="vp2"></div></div>
        </div>

        <!-- canvas for particles -->
        <canvas id="fx" width="900" height="600"></canvas>
      </div>

      <div class="controls">
        <div style="display:flex;gap:8px;align-items:center">
          <label class="small" for="bet">Aposta</label>
          <input id="bet" type="number" min="1" step="1" value="5" />
          <button id="lo" class="btn" style="padding:8px 10px">-</button>
          <button id="hi" class="btn" style="padding:8px 10px">+</button>
        </div>

        <div class="spacer"></div>

        <button id="spin" class="btn" style="width:160px;font-size:18px">SPIN</button>
      </div>

      <div style="margin-top:12px;display:flex;gap:12px;align-items:center;justify-content:space-between">
        <div>
          <div class="small">√öltimo resultado</div>
          <div id="result" class="big">‚Äî</div>
        </div>
        <div style="text-align:right">
          <div class="small">Saldo</div>
          <div id="balance" class="big">100</div>
        </div>
      </div>

      <footer>Toque em SPIN ‚Äî jogo para divers√£o (sem dinheiro real). √çcones originais.</footer>
    </div>

    <div class="side">
      <h3 style="margin-top:0">Regras & Payouts</h3>
      <div style="margin:8px 0;color:var(--muted)">
        3 iguais: <strong>12√ó</strong><br>
        2 iguais: <strong>3√ó</strong><br>
        S√≠mbolo especial (estrela): <strong>jackpot 30√ó</strong>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">

      <div class="stat"><div class="small">Sess√£o</div><div id="sessionWins" class="small">0 vit√≥rias</div></div>
      <div class="stat"><div class="small">Maior ganho</div><div id="bestWin" class="small">-</div></div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
      <div class="small">Configura√ß√µes:</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="reset" class="btn" style="padding:8px">Reset Saldo</button>
        <button id="togSound" class="btn" style="padding:8px">Som On</button>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px">
        Dica: toque e segure SPIN para spin r√°pido. C√≥digo pronto para ser transformado em PWA.
      </div>
    </div>
  </div>

<script>
/* ======= Config e Estado ======= */
const SYMBOLS = [
  {id:'orange', label:'üçä'},
  {id:'lemon', label:'üçã'},
  {id:'cherry', label:'üçí'},
  {id:'grape', label:'üçá'},
  {id:'pine', label:'üçç'},
  {id:'star', label:'‚≠ê'},
  {id:'tiger', label:'üêØ'}
];
const REELS = 3;
const VIEWPORT = 180; // px height per symbol
const TRACK_REPEAT = 7; // quantas repeti√ß√µes para anima√ß√£o longa
const balanceEl = document.getElementById('balance');
const resultEl = document.getElementById('result');
const sessionWinsEl = document.getElementById('sessionWins');
const bestWinEl = document.getElementById('bestWin');

let spinning = false;
let balance = Number(localStorage.getItem('slot_balance')||100);
let sessionWins = 0;
let bestWin = Number(localStorage.getItem('slot_best')||0);
updateUI();

/* ======= Constru√ß√£o dos Tracks (DOM) ======= */
for(let r=0;r<REELS;r++){
  const vp = document.getElementById('vp'+r);
  // criar muitos elementos para scroll longo
  vp.style.transition = 'none';
  vp.style.transform = `translateY(0px)`;
  vp.innerHTML = '';
  for(let rep=0; rep<TRACK_REPEAT; rep++){
    for(let s=0;s<SYMBOLS.length;s++){
      const d = document.createElement('div');
      d.className = 'slot-row';
      d.style.height = VIEWPORT+'px';
      d.innerText = SYMBOLS[s].label;
      vp.appendChild(d);
    }
  }
  // centralizar para exibir s√≠mbolo do meio (opcional)
  vp.style.transform = `translateY(${-VIEWPORT}px)`;
}

/* ======= UI e controles ======= */
const betInput = document.getElementById('bet');
document.getElementById('lo').addEventListener('click', ()=>{ let v=Number(betInput.value)||1; v=Math.max(1,Math.floor(v/2)); betInput.value=v; });
document.getElementById('hi').addEventListener('click', ()=>{ let v=Number(betInput.value)||1; betInput.value=Math.min(9999, Math.floor(v*2)); });
const spinBtn = document.getElementById('spin');
spinBtn.addEventListener('click', spinHandler);
spinBtn.addEventListener('contextmenu', e=>{ e.preventDefault(); quickSpin(); }); // toque longo / segurar? fallback

document.getElementById('reset').addEventListener('click', ()=>{
  balance = 100; localStorage.setItem('slot_balance', balance); updateUI();
});
const sndBtn = document.getElementById('togSound');
let soundOn = true;
sndBtn.addEventListener('click', ()=>{ soundOn = !soundOn; sndBtn.textContent = soundOn ? 'Som On' : 'Som Off'; });

/* ======= Part√≠culas Canvas ======= */
const canvas = document.getElementById('fx');
const ctx = canvas.getContext('2d');
function fitCanvas(){ const rect = document.querySelector('.wrap').getBoundingClientRect(); canvas.width = rect.width; canvas.height = rect.height * 1.05; canvas.style.width = rect.width+'px'; canvas.style.height = canvas.height+'px'; }
fitCanvas();
window.addEventListener('resize', fitCanvas);
let particles = [];
function emitParticles(x,y, color='#ffcf6b',count=40){
  for(let i=0;i<count;i++){
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*6,
      vy: (Math.random()-0.9)* -6,
      life: 60 + Math.random()*40,
      size: 6+Math.random()*8,
      color,
    });
  }
}
function updateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.18; p.life--;
    if(p.life<=0 || p.y>canvas.height+50) particles.splice(i,1);
    else{
      ctx.globalAlpha = Math.max(0, p.life/100);
      ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.size*(p.life/100), 0, Math.PI*2); ctx.fill();
    }
  }
  requestAnimationFrame(updateParticles);
}
requestAnimationFrame(updateParticles);

/* ======= WebAudio simples para feedback sonoro ======= */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function playBeep(freq=440, time=0.05, type='sine', gain=0.08){
  if(!soundOn) return;
  if(!audioCtx) audioCtx = new AudioCtx();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + time);
}

/* ======= Spin physics: each rolo tem dura√ß√£o pr√≥pria, easing out ======= */
function spinHandler(){
  if(spinning) return;
  let bet = Math.max(1, Math.floor(Number(betInput.value) || 1));
  if(bet > balance){ resultEl.textContent = 'Saldo insuficiente'; playBeep(160,0.12,'sawtooth',0.06); return; }
  startSpin(bet);
}
function quickSpin(){ // spin r√°pido (menos duration)
  if(spinning) return;
  let bet = Math.max(1, Math.floor(Number(betInput.value) || 1));
  if(bet > balance){ resultEl.textContent = 'Saldo insuficiente'; return; }
  startSpin(bet, {fast:true});
}

/* main spin routine */
async function startSpin(bet, opts={}){
  spinning = true;
  spinBtn.disabled = true;
  balance -= bet; localStorage.setItem('slot_balance', balance); updateUI();
  resultEl.textContent = 'Girando...';
  playBeep(420,0.06,'sine',0.06);

  // determine final symbols (random) but with small weight to make star rarer
  function randSymbol(){
    const r = Math.random();
    if(r>0.96) return SYMBOLS.findIndex(s=>s.id==='star'); // raridade
    return Math.floor(Math.random()*SYMBOLS.length);
  }
  const finals = [randSymbol(), randSymbol(), randSymbol()];

  // animate each reel: compute total steps (symbol counts) to move
  const promises = [];
  for(let r=0;r<REELS;r++){
    const base = opts.fast ? randInt(3,6) : randInt(7,11);
    const extra = randInt(0, SYMBOLS.length-1);
    const totalSymbols = base*SYMBOLS.length + finals[r] + extra;
    const duration = opts.fast ? 700 + r*80 : 1500 + r*450 + Math.floor(Math.random()*300);
    promises.push(animateReel(r, totalSymbols, duration));
  }

  // visual: add spin class to blur reels
  for(let r=0;r<REELS;r++) document.getElementById('reel'+r).classList.add('spin');

  await Promise.all(promises);

  // remove spin blur
  for(let r=0;r<REELS;r++) document.getElementById('reel'+r).classList.remove('spin');

  // compute payout
  const ids = finals.map(i=>SYMBOLS[i].id);
  let win = 0;
  if(ids[0]===ids[1] && ids[1]===ids[2]){ // triple
    if(ids[0]==='star') win = bet * 30;
    else win = bet * 12;
  } else if(ids[0]===ids[1] || ids[1]===ids[2] || ids[0]===ids[2]){
    win = bet * 3;
  }

  if(win>0){
    balance += win; localStorage.setItem('slot_balance', balance);
    resultEl.textContent = `Ganhou ${win} moedas! (${SYMBOLS[finals[0]].label} ${SYMBOLS[finals[1]].label} ${SYMBOLS[finals[2]].label})`;
    sessionWins++; sessionWinsEl.textContent = sessionWins + ' vit√≥rias';
    if(win > bestWin){ bestWin = win; localStorage.setItem('slot_best', bestWin); bestWinEl.textContent = win; }
    // celebratory particles above reels
    const rect = document.querySelector('.reels').getBoundingClientRect();
    emitParticles(rect.left + rect.width/2, rect.top + 40, '#ffd86b', 80);
    playBeep(820,0.12,'sine',0.12);
    setTimeout(()=>{ playBeep(580,0.08,'triangle',0.06)}, 120);
    // highlight reels
    for(let r=0;r<REELS;r++){
      const el = document.getElementById('reel'+r);
      if(ids.filter(x=>x===ids[r]).length>=2) el.classList.add('win');
      setTimeout(()=>el.classList.remove('win'), 1600);
    }
  } else {
    resultEl.textContent = `Sem combina√ß√£o (${SYMBOLS[finals[0]].label} ${SYMBOLS[finals[1]].label} ${SYMBOLS[finals[2]].label})`;
    playBeep(240,0.08,'sawtooth',0.04);
  }

  updateUI();
  setTimeout(()=>{ spinning=false; spinBtn.disabled=false; }, 420);
}

/* animateReel: transita a viewport transform para -totalSymbols * VIEWPORT, com easing */
function animateReel(reelIndex, totalSymbols, duration){
  return new Promise(resolve=>{
    const vp = document.getElementById('vp'+reelIndex);
    // current transform y
    let startY = getTranslateY(vp);
    // final target (negative)
    const endY = startY - totalSymbols * VIEWPORT;
    // we will animate using requestAnimationFrame with an easeOutCubic
    const t0 = performance.now();
    function frame(t){
      const p = Math.min(1, (t - t0) / duration);
      const eased = easeOutCubic(p);
      const curY = startY + (endY - startY) * eased;
      vp.style.transform = `translateY(${curY}px)`;
      if(p < 1) requestAnimationFrame(frame);
      else {
        // snap to a short track centered on final symbol to avoid huge offsets
        // compute final symbol index modulo symbols length
        const totalSyms = Math.abs(Math.round((endY - startY) / VIEWPORT));
        const finalIndex = totalSyms % SYMBOLS.length;
        // rebuild smaller track around finalIndex
        vp.innerHTML = '';
        const context = 3;
        for(let i=-context;i<=context;i++){
          const idx = mod(finalIndex + i, SYMBOLS.length);
          const d = document.createElement('div');
          d.className = 'slot-row';
          d.style.height = VIEWPORT+'px';
          d.innerText = SYMBOLS[idx].label;
          vp.appendChild(d);
        }
        // position so that middle symbol is centered
        vp.style.transition = 'none';
        vp.style.transform = `translateY(${-context*VIEWPORT}px)`;
        // small delay to smooth final visual
        setTimeout(()=>resolve(), 40);
      }
    }
    requestAnimationFrame(frame);
  });
}

/* easing & helpers */
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }
function getTranslateY(el){
  const st = getComputedStyle(el).transform;
  if(st && st !== 'none'){
    const m = st.match(/matrix.*\((.+)\)/);
    if(m){ const vals = m[1].split(', '); return parseFloat(vals[5]); }
  }
  return 0;
}
function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function mod(n,m){ return ((n % m) + m) % m; }

/* ======= small helpers UI ======= */
function updateUI(){
  balanceEl.textContent = balance;
  sessionWinsEl.textContent = sessionWins + ' vit√≥rias';
  bestWinEl.textContent = bestWin>0? bestWin : '-';
}
updateUI();

/* ======= initialize small touch UX: hold spin to quick spin (mobile friendly) ======= */
let holdTimer = null;
spinBtn.addEventListener('touchstart', ()=>{
  holdTimer = setTimeout(()=>{ quickSpin(); }, 400);
});
spinBtn.addEventListener('touchend', ()=>{ if(holdTimer) clearTimeout(holdTimer); });

/* ======= small utility: persist balance on unload ======= */
window.addEventListener('beforeunload', ()=>{ localStorage.setItem('slot_balance', balance); });

/* ready */
document.addEventListener('DOMContentLoaded', ()=>{ /* nothing extra */ });

</script>
</body>
</html>