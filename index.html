<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Roleta ‚Äî Premium (Mascote + Painel 12)</title>
<meta name="description" content="Demo original de slot estilizado. Sem dinheiro real." />
<style>
:root{
  --bg1:#061226; --bg2:#08243a; --glass:rgba(255,255,255,.03);
  --muted:#97a9b9; --accent:#ffd86b; --accent2:#ff7b7b;
  font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaf6ff;display:flex;align-items:center;justify-content:center;padding:16px}
.app{width:100%;max-width:1200px;display:grid;grid-template-columns:260px 1fr 340px;gap:16px}
@media(max-width:1080px){.app{grid-template-columns:1fr}.left,.right{order:2}.center{order:1}}
.card{border-radius:12px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,.012),transparent);box-shadow:0 12px 36px rgba(0,0,0,.5)}
/* LEFT */
.left{display:flex;flex-direction:column;align-items:center;gap:12px}
.mascot-wrap{width:210px;height:210px;display:flex;align-items:center;justify-content:center}
#mascot{width:170px;height:170px;transform-origin:center}
.mascot-cheer{animation:cheer .9s ease forwards}
@keyframes cheer{0%{transform:translateY(0) scale(1)}30%{transform:translateY(-10px) scale(1.06) rotate(-2deg)}60%{transform:translateY(0) scale(1.03) rotate(2deg)}100%{transform:translateY(-6px) scale(1.04)}}
.meter{display:grid;grid-template-columns:repeat(3,44px);gap:10px;justify-content:center}
.cell{width:44px;height:44px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,.06);transition:transform .2s,box-shadow .2s,background .2s}
.cell.on{background:linear-gradient(180deg,rgba(255,210,110,.2),rgba(255,150,50,.08));box-shadow:0 10px 26px rgba(255,165,50,.12);transform:translateY(-6px) scale(1.05)}
/* CENTER */
.center{display:flex;flex-direction:column;gap:12px;align-items:center}
.header{width:100%;display:flex;justify-content:space-between;align-items:center}
.balance{font-size:22px;font-weight:800}
.reels{display:flex;gap:12px;align-items:center;justify-content:center;width:100%}
.reel{width:140px;height:200px;overflow:hidden;border-radius:12px;position:relative;background:linear-gradient(180deg,#081a2a,#06283a);border:1px solid rgba(255,255,255,.06);box-shadow:inset 0 8px 20px rgba(0,0,0,.6)}
.viewport{position:absolute;left:0;top:0;width:100%;height:100%;will-change:transform}
.slot{height:200px;display:flex;align-items:center;justify-content:center;font-size:64px;user-select:none}
.reel.spin .viewport{filter:blur(2.2px) saturate(1.05)}
.controls{display:flex;gap:10px;align-items:center;width:100%}
input[type=number]{width:110px;padding:10px;border-radius:10px;border:0;background:#071827;color:#dff6ff;font-weight:700;text-align:center}
.btn{background:linear-gradient(180deg,var(--accent),var(--accent2));color:#061226;border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn:active{transform:translateY(1px)}
/* RIGHT */
.right{display:flex;flex-direction:column;gap:10px}
.stat{display:flex;justify-content:space-between;align-items:center;padding:4px 0}
.small{font-size:13px;color:var(--muted)}
/* FX */
#fx{position:fixed;left:0;top:0;pointer-events:none;z-index:1000}
.app.shake{animation:shake .7s ease}
@keyframes shake{0%{transform:translateY(0)}30%{transform:translateY(-8px)}60%{transform:translateY(2px)}100%{transform:translateY(0)}}
footer{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}
</style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="app" id="app">
  <!-- LEFT -->
  <div class="card left">
    <div class="mascot-wrap" aria-hidden="true">
      <svg id="mascot" viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Mascote">
        <defs>
          <linearGradient id="gM" x1="0" x2="1"><stop offset="0" stop-color="#ffd56a"/><stop offset="1" stop-color="#ff8b6b"/></linearGradient>
          <filter id="glow"><feGaussianBlur stdDeviation="6" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <g transform="translate(120,120)">
          <ellipse cx="0" cy="16" rx="64" ry="70" fill="url(#gM)" filter="url(#glow)"/>
          <g transform="translate(0,-8)">
            <circle cx="-22" cy="-8" r="10" fill="#fff"/>
            <circle cx="22" cy="-8" r="10" fill="#fff"/>
            <circle cx="-22" cy="-8" r="3" fill="#1a2b3b"/>
            <circle cx="22" cy="-8" r="3" fill="#1a2b3b"/>
            <path d="M -14 8 q14 14 28 0" stroke="#6d2a2a" stroke-width="3" stroke-linecap="round" fill="none"/>
          </g>
          <g transform="translate(-60,8)"><rect x="-6" y="-6" width="12" height="28" rx="6" fill="#ffd56a"/></g>
          <g transform="translate(60,8)"><rect x="-6" y="-6" width="12" height="28" rx="6" fill="#ffd56a"/></g>
        </g>
      </svg>
    </div>
    <div style="text-align:center">
      <div style="font-weight:800">B√¥nus Meter</div>
      <div class="small">Complete os 12 quadrados</div>
    </div>
    <div class="meter" id="meter"></div>
    <div class="small"><strong id="meterCount">0</strong> / 12</div>
    <div style="display:flex;gap:8px;margin-top:6px;width:100%">
      <button id="claim" class="btn" style="flex:1">Resgatar</button>
      <button id="reset" class="btn" style="flex:1">Reset</button>
    </div>
  </div>

  <!-- CENTER -->
  <div class="card center">
    <div class="header">
      <div>
        <div class="small">Roleta Premium (demo)</div>
        <div class="small">Toque SPIN para jogar</div>
      </div>
      <div>
        <div class="small">Saldo</div>
        <div class="balance" id="balance">300</div>
      </div>
    </div>

    <div class="reels" id="reels">
      <div class="reel"><div class="viewport" id="vp0"></div></div>
      <div class="reel"><div class="viewport" id="vp1"></div></div>
      <div class="reel"><div class="viewport" id="vp2"></div></div>
    </div>

    <div class="controls">
      <label class="small" for="bet">Aposta</label>
      <input id="bet" type="number" min="1" value="5" />
      <button id="dec" class="btn">-</button>
      <button id="inc" class="btn">+</button>
      <div style="flex:1"></div>
      <button id="spin" class="btn" style="width:140px">SPIN</button>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
      <div class="small">√öltimo</div>
      <div id="result" style="font-weight:800">‚Äî</div>
    </div>

    <footer>Sem dinheiro real. Probabilidades configur√°veis no painel √† direita.</footer>
  </div>

  <!-- RIGHT -->
  <div class="card right">
    <h3 style="margin:0">Payouts & Chances</h3>
    <div class="stat">
      <div>
        <div style="font-weight:700">Comuns (üçäüçãüçíüçáüêØ)</div>
        <div class="small">3 iguais: <input id="p_common" type="number" value="12" style="width:70px">√ó</div>
      </div>
      <div style="text-align:right">
        <div class="small">Peso (chance): <input id="w_common" type="number" value="40" style="width:70px"></div>
      </div>
    </div>
    <div class="stat">
      <div>
        <div style="font-weight:700">Raro (‚≠ê)</div>
        <div class="small">3 estrelas: <input id="p_star" type="number" value="30" style="width:70px">√ó</div>
      </div>
      <div style="text-align:right">
        <div class="small">Peso (chance): <input id="w_star" type="number" value="6" style="width:70px"></div>
      </div>
    </div>
    <div class="stat">
      <div style="font-weight:700">B√¥nus do Painel</div>
      <div class="small"><input id="meterBonus" type="number" value="250" style="width:90px"> moedas</div>
    </div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,.08)" />
    <div class="stat"><div class="small">Vit√≥rias (sess√£o)</div><div id="sessionWins" class="small">0</div></div>
    <div class="stat"><div class="small">Maior ganho</div><div id="bestWin" class="small">-</div></div>
    <div style="display:flex;gap:8px">
      <button id="sound" class="btn">Som: On</button>
      <button id="vibe" class="btn">Vibra√ß√£o: On</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
/* ======= Estado ======= */
const SYMBOLS = [
  {id:'orange', label:'üçä', common:true},
  {id:'lemon',  label:'üçã', common:true},
  {id:'cherry', label:'üçí', common:true},
  {id:'grape',  label:'üçá', common:true},
  {id:'tiger',  label:'üêØ', common:true},
  {id:'star',   label:'‚≠ê', common:false}
];
const REELS=3, VIEW=200, REPEAT=9;

let balance = +localStorage.getItem('s_bal')||300;
let bestWin = +localStorage.getItem('s_best')||0;
let sessionWins = 0;
let meter = +localStorage.getItem('s_meter')||0;
let soundOn = (localStorage.getItem('s_sound')||'1')==='1';
let vibeOn = (localStorage.getItem('s_vibe')||'1')==='1';

/* ======= DOM ======= */
const app = document.getElementById('app');
const balanceEl = document.getElementById('balance');
const resultEl = document.getElementById('result');
const sessionWinsEl = document.getElementById('sessionWins');
const bestWinEl = document.getElementById('bestWin');
const meterRoot = document.getElementById('meter');
const meterCountEl = document.getElementById('meterCount');
const betEl = document.getElementById('bet');
const spinBtn = document.getElementById('spin');
const incBtn = document.getElementById('inc');
const decBtn = document.getElementById('dec');
const resetBtn = document.getElementById('reset');
const claimBtn = document.getElementById('claim');
const soundBtn = document.getElementById('sound');
const vibeBtn = document.getElementById('vibe');
const vp = [document.getElementById('vp0'),document.getElementById('vp1'),document.getElementById('vp2')];
const p_common = document.getElementById('p_common');
const p_star = document.getElementById('p_star');
const w_common = document.getElementById('w_common');
const w_star = document.getElementById('w_star');
const meterBonus = document.getElementById('meterBonus');
const mascot = document.getElementById('mascot');

/* ======= √Åudio ======= */
const AC = window.AudioContext||window.webkitAudioContext;
let actx=null; function ensureAudio(){ if(!actx) actx=new AC(); }
function tone(f=440,d=0.08,t='sine',g=0.08,delay=0){
  if(!soundOn) return; ensureAudio();
  const o=actx.createOscillator(), gn=actx.createGain();
  o.type=t; o.frequency.value=f; gn.gain.value=g;
  o.connect(gn); gn.connect(actx.destination);
  o.start(actx.currentTime+delay); o.stop(actx.currentTime+delay+d);
}

/* ======= Part√≠culas ======= */
const canvas=document.getElementById('fx'); const ctx=canvas.getContext('2d');
function fit(){canvas.width=innerWidth;canvas.height=innerHeight} fit(); addEventListener('resize',fit);
const parts=[];
function emit(kind,x,y,n=60){for(let i=0;i<n;i++){parts.push({kind,x,y,vx:(Math.random()-0.5)*7,vy:-Math.random()*8-2,life:60+Math.random()*60,size:6+Math.random()*8,c:['#ffd86b','#ff9c9c','#9ae6b4','#9ac8ff'][Math.floor(Math.random()*4)]})}}
function step(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=parts.length-1;i>=0;i--){
    const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=.35; p.life--;
    if(p.life<=0||p.y>canvas.height+80){parts.splice(i,1);continue}
    ctx.globalAlpha=Math.max(0,p.life/120);
    if(p.kind==='coin'){ctx.beginPath(); ctx.fillStyle='#ffd86b'; ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();}
    else{ctx.fillStyle=p.c; ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size*1.5)}
  }
  requestAnimationFrame(step);
}
requestAnimationFrame(step);

/* ======= UI ======= */
function save(){localStorage.setItem('s_bal',balance);localStorage.setItem('s_best',bestWin);localStorage.setItem('s_meter',meter);localStorage.setItem('s_sound',soundOn?'1':'0');localStorage.setItem('s_vibe',vibeOn?'1':'0')}
function ui(){
  balanceEl.textContent=balance;
  sessionWinsEl.textContent=sessionWins;
  bestWinEl.textContent=bestWin>0?bestWin:'-';
  soundBtn.textContent='Som: '+(soundOn?'On':'Off');
  vibeBtn.textContent='Vibra√ß√£o: '+(vibeOn?'On':'Off');
  meterCountEl.textContent=meter;
}
function buildMeter(){
  meterRoot.innerHTML='';
  for(let i=0;i<12;i++){const d=document.createElement('div');d.className='cell'; if(i<meter)d.classList.add('on'); meterRoot.appendChild(d);}
}
ui(); buildMeter();

/* ======= Reels ======= */
function buildTracks(){
  for(let r=0;r<REELS;r++){
    const c=vp[r]; c.innerHTML='';
    for(let k=0;k<REPEAT;k++){
      for(let s=0;s<SYMBOLS.length;s++){
        const el=document.createElement('div'); el.className='slot'; el.style.height=VIEW+'px';
        el.textContent=SYMBOLS[s].label; c.appendChild(el);
      }
    }
    c.style.transform='translateY('+(-VIEW)+'px)'; // centraliza
  }
}
buildTracks();

function easeOutQuart(t){return 1-Math.pow(1-t,4)}
function getY(el){const tr=getComputedStyle(el).transform;if(tr&&tr!=='none'){const m=tr.match(/matrix.*\((.+)\)/);if(m){return parseFloat(m[1].split(', ')[5])}}return 0}
function mod(n,m){return ((n%m)+m)%m}
function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a}

/* ======= Probabilidades ======= */
function weightedPick(){
  const wc=+w_common.value||40, ws=+w_star.value||6;
  const map=SYMBOLS.map(s=>({id:s.id,label:s.label, w:s.id==='star'?ws:wc}));
  let total=map.reduce((a,b)=>a+b.w,0);
  let r=Math.random()*total;
  for(const m of map){ if(r<m.w) return SYMBOLS.findIndex(x=>x.id===m.id); r-=m.w; }
  return 0;
}

/* ======= Jogo ======= */
let spinning=false, lockClick=false;

spinBtn.addEventListener('click', ()=>{ if(!spinning&&!lockClick) spin(); });
incBtn.addEventListener('click', ()=>{ betEl.value=Math.min(999999, Math.max(1,(+betEl.value||1)*2)) });
decBtn.addEventListener('click', ()=>{ betEl.value=Math.max(1, Math.floor((+betEl.value||1)/2)) });
resetBtn.addEventListener('click', ()=>{ balance=300; sessionWins=0; bestWin=0; meter=0; save(); ui(); buildMeter(); });
claimBtn.addEventListener('click', ()=>{ if(meter>=12){ const b=+meterBonus.value||250; balance+=b; meter=0; save(); ui(); buildMeter(); emit('coin', innerWidth/2, 120, 80); tone(980,.12,'triangle',.12);} else { resultEl.textContent='Painel incompleto'; } });
soundBtn.addEventListener('click', ()=>{ soundOn=!soundOn; save(); ui(); });
vibeBtn.addEventListener('click', ()=>{ vibeOn=!vibeOn; save(); ui(); });

async function spin(){
  spinning=true; lockClick=true; spinBtn.disabled=true;
  const bet=Math.max(1, Math.floor(+betEl.value||1));
  if(bet>balance){ resultEl.textContent='Saldo insuficiente'; tone(180,.12,'sawtooth',.06); spinning=false; spinBtn.disabled=false; lockClick=false; return;}
  balance-=bet; save(); ui(); resultEl.textContent='Girando...'; tone(420,.06,'sine',.06);

  const finals=[weightedPick(),weightedPick(),weightedPick()];
  const tasks=[];
  for(let r=0;r<REELS;r++){
    const base=rand(7,10), extra=rand(0,SYMBOLS.length-1);
    const total=base*SYMBOLS.length + finals[r] + extra;
    const dur=1200 + r*380 + rand(0,200);
    tasks.push(animateReel(r,total,dur));
    vp[r].parentElement.classList.add('spin');
  }
  await Promise.all(tasks);
  vp.forEach(v=>v.parentElement.classList.remove('spin'));

  const ids=finals.map(i=>SYMBOLS[i].id);
  let win=0;
  if(ids[0]===ids[1] && ids[1]===ids[2]){
    win = (ids[0]==='star' ? (+p_star.value||30) : (+p_common.value||12)) * bet;
  } else if(ids[0]===ids[1] || ids[1]===ids[2] || ids[0]===ids[2]){
    win = 3 * bet;
  }

  if(win>0){
    balance+=win; sessionWins++; if(win>bestWin) bestWin=win;
    meter=Math.min(12, meter + (ids[0]===ids[1] && ids[1]===ids[2] && ids[0]==='star' ? 4 : 1));
    save(); ui(); buildMeter();
    const rect=document.getElementById('reels').getBoundingClientRect();
    emit('confetti', rect.left+rect.width/2, rect.top+40, 140);
    emit('coin', rect.left+rect.width/2, rect.top+60, 30);
    resultEl.textContent=`Ganhou ${win} ‚Äî ${SYMBOLS[finals[0]].label} ${SYMBOLS[finals[1]].label} ${SYMBOLS[finals[2]].label}`;
    mascot.classList.remove('mascot-cheer'); void mascot.offsetWidth; mascot.classList.add('mascot-cheer');
    tone(880,.12,'sine',.12); setTimeout(()=>tone(720,.09,'triangle',.1),100);
    if(vibeOn && navigator.vibrate) navigator.vibrate([80,30,80]);
  } else {
    resultEl.textContent=`Sem combina√ß√£o ‚Äî ${SYMBOLS[finals[0]].label} ${SYMBOLS[finals[1]].label} ${SYMBOLS[finals[2]].label}`;
    tone(220,.08,'sawtooth',.06);
  }

  if(meter>=12){ await bigBonus(); }

  spinning=false; setTimeout(()=>{ spinBtn.disabled=false; lockClick=false; }, 250);
}

function animateReel(idx,totalSymbols,dur){
  return new Promise(res=>{
    const c=vp[idx]; const y0=getY(c); const y1=y0 - totalSymbols*VIEW; const t0=performance.now();
    function frame(t){
      const p=Math.min(1,(t-t0)/dur), e=easeOutQuart(p);
      c.style.transform=`translateY(${y0 + (y1-y0)*e}px)`;
      if(p<1){requestAnimationFrame(frame)} else {
        // calcula s√≠mbolo final
        const moved=Math.abs(Math.round((y1-y0)/VIEW)); const fin=moved % SYMBOLS.length;
        // reconstr√≥i faixa curta centrada no final
        c.innerHTML=''; const ctx=3;
        for(let i=-ctx;i<=ctx;i++){
          const id = ( (fin+i) % SYMBOLS.length + SYMBOLS.length ) % SYMBOLS.length;
          const el=document.createElement('div'); el.className='slot'; el.style.height=VIEW+'px'; el.textContent=SYMBOLS[id].label; c.appendChild(el);
        }
        c.style.transition='none'; c.style.transform=`translateY(${-ctx*VIEW}px)`;
        res();
      }
    }
    requestAnimationFrame(frame);
  });
}

async function bigBonus(){
  const rect=app.getBoundingClientRect();
  for(let i=0;i<8;i++){ emit('confetti', rect.left+Math.random()*rect.width, rect.top+60+Math.random()*rect.height/2, 90); emit('coin', rect.left+Math.random()*rect.width, rect.top+60+Math.random()*rect.height/2, 40); }
  tone(1200,.18,'sine',.16); tone(980,.12,'triangle',.12);
  if(vibeOn && navigator.vibrate) navigator.vibrate([120,40,120]);
  const bonus=+meterBonus.value||250; balance+=bonus; meter=0; sessionWins++; save(); ui(); buildMeter();
  resultEl.textContent=`B√îNUS COMPLETO! +${bonus}`;
  app.classList.add('shake'); setTimeout(()=>app.classList.remove('shake'),900);
}
});
</script>
</body>
</html>